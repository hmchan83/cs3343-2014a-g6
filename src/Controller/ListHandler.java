package Controller;

import ioMoudle.DebugMessager;
import Controller.MainController;

import java.util.ArrayList;

import store.Course;
import store.Section;


public class ListHandler {
	
	public ListHandler(){
		
	}
	/**
	 * Try to found out the priority and conflict number of each section
	 * @param list courselist generated by the Main
	 */
	public void listformat(ArrayList<Course> list){
		DebugMessager.debug("\tListHandler Start setting priority");
		int maxSecNum=0;
		Boolean SimpleCase = true; 
		for(Course c : list){ // get the largest Section nums => used to determine the priority
			/* if the Max. Section of ALL course < 10 the priority will be 2 digit
			 * if the number is >=10 and <100 the priority will be 2 digit
			 * the most left number is refer to the course, that means section for same course will have same value
			 */
			if(maxSecNum<c.SectionNum()){
				maxSecNum=c.SectionNum(); 
			}
		}
		DebugMessager.debug("Largest Section Num = "+maxSecNum);
		int places = (int) (Math.floor(Math.log10(maxSecNum))+1);
		DebugMessager.debug("Places need = "+places);
		int courseNum = list.size();
		for(int i=0;i<courseNum;i++){ // init the Priority table
			Course c = list.get(i);
			DebugMessager.debug("ListHandler handling Course "+c.getCourseID());
			ArrayList<Section> seclist=c.getSec();
			int tempPriority=(courseNum-c.getPriority()+1)*((int)Math.pow(10, places)) + seclist.size();
			for(int j=0;j<seclist.size();j++){
				Section s = seclist.get(j);
				DebugMessager.debug("\tListHandler handling Section "+s.getSectionID());
				s.setPriority(tempPriority--);
				int CourseConflict = ConflictDetector.run(list, i,s);
				if(c.getSecNumMinConflict()==courseNum) SimpleCase = false;
				s.setCourseConflict(CourseConflict);
				DebugMessager.debug("\tListHandler Section "+s.getSectionID()+", priority = "+tempPriority);
			}
		}
		MainController.setSimpleHandler(SimpleCase);
		DebugMessager.debug("\tListHandler End.");
	}

}
